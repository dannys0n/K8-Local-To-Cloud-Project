{
  "Makefile": "up: cluster monitors managers databases port-forward\n\ncluster:\n\t./src/scripts/cluster.sh\n\nmonitors:\n\t./src/scripts/monitors.sh\n\nmanagers:\n\t./src/scripts/managers.sh\n\ndatabases: redis postgres\n\ndatabases-namespace:\n\tkubectl apply -f src/databases/namespace.yaml\n\nredis: databases-namespace\n\tkubectl apply -f src/databases/redis.yaml\n\tkubectl rollout status deployment/redis -n databases\n\npostgres: databases-namespace\n\tkubectl apply -f src/databases/postgres.yaml\n\tkubectl rollout status deployment/postgres -n databases\n\nport-forward:\n\t./src/scripts/port-forward.sh\n\ndown:\n\t./src/scripts/teardown.sh\n\nstatus:\n\tkubectl get pods -n monitoring\n\nping-redis:\n\t./src/scripts/ping-redis.sh\n\nping-postgres:\n\t./src/scripts/ping-postgres.sh",
  "src/monitoring/values.yaml": "grafana:\n  enabled: true\n  service:\n    type: ClusterIP\n\nprometheus:\n  service:\n    type: ClusterIP\n\nalertmanager:\n  enabled: false\n",
  "src/scripts/cluster.sh": "#!/usr/bin/env bash\nset -euo pipefail\n\nCLUSTER_NAME=dev\n\ncommand -v kind >/dev/null\ncommand -v kubectl >/dev/null\ncommand -v helm >/dev/null\n\necho \"Creating kind cluster...\"\nkind create cluster \\\n  --name \"${CLUSTER_NAME}\" \\\n  --config src/kind/cluster.yaml || true\n",
  "src/scripts/port-forward.sh": "#!/usr/bin/env bash\nset -euo pipefail\n\nPID_DIR=.pids\nmkdir -p \"${PID_DIR}\"\n\nstart_pf () {\n  local name=$1\n  local namespace=$2\n  local svc=$3\n  local local_port=$4\n  local remote_port=$5\n\n  if [[ -f \"${PID_DIR}/${name}.pid\" ]] && kill -0 \"$(cat \"${PID_DIR}/${name}.pid\")\" 2>/dev/null; then\n    return\n  fi\n\n  kubectl port-forward -n \"${namespace}\" \"svc/${svc}\" \\\n    \"${local_port}:${remote_port}\" \\\n    > /dev/null 2>&1 &\n\n  echo $! > \"${PID_DIR}/${name}.pid\"\n}\n\n# Monitoring\nstart_pf grafana     monitoring monitoring-grafana                     3000 80\nstart_pf prometheus  monitoring monitoring-kube-prometheus-prometheus  9090 9090\n\n# Managing (Portainer)\nstart_pf portainer   portainer  portainer                             9000 9000\n\n# Databases\nstart_pf redis       databases  redis                                6379 6379\nstart_pf postgres    databases  postgres                             5432 5432\n\necho \"\"\necho \"kubectl get secret --namespace monitoring -l app.kubernetes.io/component=admin-secret -o jsonpath=\"{.items[0].data.admin-password}\" | base64 --decode ; echo\"\necho \"READY:\"\necho \"  Grafana    http://localhost:3000\"\necho \"  Prometheus http://localhost:9090\"\necho \"  Portainer  http://localhost:9000 (create admin on first visit)\"\necho \"  Redis      localhost:6379\"\necho \"  Postgres   localhost:5432 (postgres/postgres, db=app)\"",
  "src/scripts/managers.sh": "#!/usr/bin/env bash\nset -euo pipefail\n\necho \"Installing Portainer (managing UI)...\"\nhelm repo add portainer https://portainer.github.io/k8s/ >/dev/null 2>&1 || true\nhelm repo update >/dev/null\nhelm upgrade --install portainer portainer/portainer \\\n  --namespace portainer \\\n  --create-namespace \\\n  --values src/managing/portainer-values.yaml\nkubectl rollout status deployment/portainer -n portainer\n",
  "src/scripts/stop-port-forward.sh": "#!/usr/bin/env bash\nset -euo pipefail\n\nPID_DIR=.pids\n[[ -d \"${PID_DIR}\" ]] || exit 0\n\nfor pidfile in \"${PID_DIR}\"/*.pid; do\n  [[ -f \"${pidfile}\" ]] || continue\n  pid=$(cat \"${pidfile}\")\n  kill \"${pid}\" 2>/dev/null || true\ndone\n\nrm -rf \"${PID_DIR}\"\n",
  "src/scripts/monitors.sh": "#!/usr/bin/env bash\nset -euo pipefail\n\necho \"Installing Prometheus + Grafana (kube-prometheus-stack)...\"\nhelm repo add prometheus-community https://prometheus-community.github.io/helm-charts >/dev/null 2>&1 || true\nhelm repo update >/dev/null\n\nhelm upgrade --install monitoring prometheus-community/kube-prometheus-stack \\\n  --namespace monitoring \\\n  --create-namespace \\\n  --values src/monitoring/values.yaml\n\nkubectl rollout status deployment/monitoring-grafana -n monitoring\n",
  "src/scripts/teardown.sh": "#!/usr/bin/env bash\nset -euo pipefail\n\n./src/scripts/stop-port-forward.sh || true\nkind delete cluster --name dev\n",
  "src/scripts/ping-redis.sh": "#!/usr/bin/env bash\nset -euo pipefail\necho \"Pinging Redis at localhost:6379...\"\nredis-cli -h localhost -p 6379 ping || true\n",
  "src/scripts/ping-postgres.sh": "#!/usr/bin/env bash\nset -euo pipefail\n\necho \"Pinging Postgres at localhost:5432...\"\npg_isready -h localhost -p 5432 -U postgres -d app || true\n\n",
  "src/test-service/echo.yaml": "apiVersion: v1\nkind: Namespace\nmetadata:\n  name: test\n---\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: echo\n  namespace: test\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: echo\n  template:\n    metadata:\n      labels:\n        app: echo\n    spec:\n      containers:\n        - name: echo\n          image: hashicorp/http-echo:1.0\n          args:\n            - \"-text=hello from k8s\"\n          ports:\n            - containerPort: 5678\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: echo\n  namespace: test\nspec:\n  selector:\n    app: echo\n  ports:\n    - port: 80\n      targetPort: 5678\n",
  "src/databases/postgres.yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: postgres\n  namespace: databases\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: postgres\n  template:\n    metadata:\n      labels:\n        app: postgres\n    spec:\n      containers:\n        - name: postgres\n          image: postgres:16-alpine\n          ports:\n            - containerPort: 5432\n          env:\n            - name: POSTGRES_DB\n              value: app\n            - name: POSTGRES_USER\n              value: postgres\n            - name: POSTGRES_PASSWORD\n              value: postgres\n          readinessProbe:\n            exec:\n              command: [\"sh\", \"-c\", \"pg_isready -U postgres -d app\"]\n            initialDelaySeconds: 5\n            periodSeconds: 5\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: postgres\n  namespace: databases\nspec:\n  selector:\n    app: postgres\n  ports:\n    - port: 5432\n      targetPort: 5432\n\n",
  "src/databases/namespace.yaml": "apiVersion: v1\nkind: Namespace\nmetadata:\n  name: databases\n\n",
  "src/databases/redis.yaml": "apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: redis\n  namespace: databases\nspec:\n  replicas: 1\n  selector:\n    matchLabels:\n      app: redis\n  template:\n    metadata:\n      labels:\n        app: redis\n    spec:\n      containers:\n        - name: redis\n          image: redis:7-alpine\n          ports:\n            - containerPort: 6379\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: redis\n  namespace: databases\nspec:\n  selector:\n    app: redis\n  ports:\n    - port: 6379\n      targetPort: 6379\n",
  "src/managing/portainer-values.yaml": "service:\n  type: ClusterIP\n  httpPort: 9000\n\n# Manage the cluster Portainer runs in (in-cluster)\nlocalMgmt: true\n",
  "src/kind/cluster.yaml": "kind: Cluster\napiVersion: kind.x-k8s.io/v1alpha4\nnodes:\n  - role: control-plane\n"
}